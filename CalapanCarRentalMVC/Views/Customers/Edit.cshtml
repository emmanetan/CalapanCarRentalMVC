@model CalapanCarRentalMVC.Models.Customer
@{
    ViewData["Title"] = "Edit Customer";
    Layout = "_Layout";
}

<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1><i class="fas fa-user-edit me-2"></i>Edit Customer</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-controller="Admin" asp-action="Dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item"><a asp-action="Index">Customers</a></li>
                    <li class="breadcrumb-item active">Edit</li>
                </ol>
            </nav>
        </div>
        <div>
            <a asp-action="Details" asp-route-id="@Model.CustomerId" class="btn btn-info">
                <i class="fas fa-eye me-1"></i>View Details
            </a>
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i>Back to List
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="dashboard-widget">
            <h5><i class="fas fa-info-circle me-2"></i>Customer Information</h5>

            <form asp-action="Edit" method="post" enctype="multipart/form-data">
                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                <input type="hidden" asp-for="CustomerId" />
                <input type="hidden" asp-for="CreatedAt" />

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label asp-for="FirstName" class="form-label"></label>
                        <input asp-for="FirstName" class="form-control" />
                        <span asp-validation-for="FirstName" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="LastName" class="form-label"></label>
                        <input asp-for="LastName" class="form-control" />
                        <span asp-validation-for="LastName" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label asp-for="Email" class="form-label"></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                            <input asp-for="Email" class="form-control" />
                        </div>
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="PhoneNumber" class="form-label"></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                            <input asp-for="PhoneNumber" class="form-control" />
                        </div>
                        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                    </div>
                </div>

                <div class="mb-3">
                    <label asp-for="Address" class="form-label"></label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                        <textarea asp-for="Address" class="form-control" rows="2"></textarea>
                    </div>
                    <span asp-validation-for="Address" class="text-danger"></span>
                </div>

                <hr />
                <h6 class="mb-3"><i class="fas fa-id-card me-2"></i>License Information</h6>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label asp-for="LicenseNumber" class="form-label"></label>
                        <input asp-for="LicenseNumber" class="form-control" />
                        <span asp-validation-for="LicenseNumber" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="LicenseExpiryDate" class="form-label"></label>
                        <input asp-for="LicenseExpiryDate" type="date" class="form-control" />
                        <span asp-validation-for="LicenseExpiryDate" class="text-danger"></span>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">
                        <i class="fas fa-file-upload me-2"></i>Driver License Document
                        <small class="text-muted">(Optional - PDF, PNG, JPG - Max 5MB)</small>
                    </label>
                    @if (!string.IsNullOrEmpty(Model.DriverLicensePath))
                    {
                        <div class="alert alert-info mb-2">
                            <i class="fas fa-info-circle me-2"></i>
                            Current document: <a href="@Model.DriverLicensePath" target="_blank" class="alert-link">View existing license</a>
                        </div>
                    }
                    <input type="file" name="driverLicenseFile" id="driverLicenseFile" class="form-control" accept=".pdf,.png,.jpg,.jpeg" />
                    <small class="text-muted d-block mt-1">
                        <i class="fas fa-info-circle me-1"></i>Accepted formats: PDF, PNG, JPG (Maximum size: 5MB)
                        @if (!string.IsNullOrEmpty(Model.DriverLicensePath))
                        {
                            <span class="text-warning">
                                <br /><i class="fas fa-exclamation-triangle me-1"></i>Uploading a new file will replace the existing document.
                            </span>
                        }
                    </small>
                </div>

                <div class="mb-3">
                    <label class="form-label">
                        License Code (DL code) <span class="text-danger">*</span>
                    </label>
                    <small class="text-muted d-block mb-2">Select all license codes that apply to this customer</small>

                    @{
                        var selectedCodes = string.IsNullOrWhiteSpace(Model.LicenseCode)
                        ? new string[] { }
                        : Model.LicenseCode.Split(',', StringSplitOptions.RemoveEmptyEntries).Select(c => c.Trim()).ToArray();
                    }

                    <input type="hidden" name="LicenseCode" id="LicenseCodeHidden" value="@Model.LicenseCode" />

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="A" id="licenseA"
                                       @(selectedCodes.Contains("A") ? "checked" : "")>
                                <label class="form-check-label" for="licenseA">
                                    A: Motorcycle
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="A1" id="licenseA1"
                                       @(selectedCodes.Contains("A1") ? "checked" : "")>
                                <label class="form-check-label" for="licenseA1">
                                    A1: Tricycle
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="B" id="licenseB"
                                       @(selectedCodes.Contains("B") ? "checked" : "")>
                                <label class="form-check-label" for="licenseB">
                                    B: Passenger Car
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="B1" id="licenseB1"
                                       @(selectedCodes.Contains("B1") ? "checked" : "")>
                                <label class="form-check-label" for="licenseB1">
                                    B1: Passenger Van or Jeepney
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="B2" id="licenseB2"
                                       @(selectedCodes.Contains("B2") ? "checked" : "")>
                                <label class="form-check-label" for="licenseB2">
                                    B2: Light Commercial Vehicle
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="C" id="licenseC"
                                       @(selectedCodes.Contains("C") ? "checked" : "")>
                                <label class="form-check-label" for="licenseC">
                                    C: Heavy Commercial Vehicle
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="D" id="licenseD"
                                       @(selectedCodes.Contains("D") ? "checked" : "")>
                                <label class="form-check-label" for="licenseD">
                                    D: Passenger Bus
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="BE" id="licenseBE"
                                       @(selectedCodes.Contains("BE") ? "checked" : "")>
                                <label class="form-check-label" for="licenseBE">
                                    BE: Light Articulated Vehicle
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input license-checkbox" type="checkbox" value="CE" id="licenseCE"
                                       @(selectedCodes.Contains("CE") ? "checked" : "")>
                                <label class="form-check-label" for="licenseCE">
                                    CE: Heavy Articulated Vehicle
                                </label>
                            </div>
                        </div>
                    </div>
                    <span id="licenseCodeValidation" class="text-danger" style="display:none;">
                        <i class="fas fa-exclamation-triangle me-1"></i>Please select at least one license code
                    </span>
                </div>

                <hr />

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-admin-primary">
                        <i class="fas fa-save me-1"></i>Save Changes
                    </button>
                    <a asp-action="Details" asp-route-id="@Model.CustomerId" class="btn btn-secondary">
                        <i class="fas fa-times me-1"></i>Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
               // Handle License Code checkboxes
               document.addEventListener('DOMContentLoaded', function() {
               const checkboxes = document.querySelectorAll('.license-checkbox');
            const hiddenInput = document.getElementById('LicenseCodeHidden');
             const validationMessage = document.getElementById('licenseCodeValidation');
               const form = document.querySelector('form');

               function updateLicenseCode() {
             const selectedCodes = [];
         checkboxes.forEach(function(checkbox) {
        if (checkbox.checked) {
               selectedCodes.push(checkbox.value);
               }
           });
               hiddenInput.value = selectedCodes.join(', ');

         // Show/hide validation message
                       if (selectedCodes.length === 0) {
           validationMessage.style.display = 'block';
                       } else {
            validationMessage.style.display = 'none';
               }
               }

        checkboxes.forEach(function(checkbox) {
           checkbox.addEventListener('change', updateLicenseCode);
                   });

                   // Validate on form submit
         if (form) {
             form.addEventListener('submit', function(e) {
               updateLicenseCode();
               if (hiddenInput.value === '') {
                     e.preventDefault();
                         validationMessage.style.display = 'block';
        alert('Please select at least one license code.');
           return false;
              }
         });
                   }
             });
    </script>
}
