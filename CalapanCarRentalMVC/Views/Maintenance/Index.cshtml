@model IEnumerable<CalapanCarRentalMVC.Models.Maintenance>
@{
    ViewData["Title"] = "Maintenance Management";
    Layout = "_Layout";
}

<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
<h1><i class="fas fa-tools me-2"></i>Maintenance Management</h1>
            <nav aria-label="breadcrumb">
         <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-controller="Admin" asp-action="Dashboard">Dashboard</a></li>
 <li class="breadcrumb-item active">Maintenance</li>
    </ol>
       </nav>
        </div>
        <div>
         <a asp-action="Create" class="btn btn-admin-primary">
     <i class="fas fa-plus me-1"></i>Schedule Maintenance
        </a>
        </div>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>@TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
 <div class="stat-card border-start border-danger border-4">
         <div class="d-flex justify-content-between align-items-center">
     <div>
           <p class="text-muted mb-1">Urgent</p>
             <h3 class="text-danger mb-1">@ViewBag.UrgentCount</h3>
          <small class="text-muted">Requires immediate attention</small>
   </div>
       <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
</div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="stat-card border-start border-warning border-4">
      <div class="d-flex justify-content-between align-items-center">
    <div>
     <p class="text-muted mb-1">Scheduled</p>
     <h3 class="text-warning mb-1">@ViewBag.ScheduledCount</h3>
          <small class="text-muted">Upcoming maintenance</small>
    </div>
<i class="fas fa-calendar-check fa-2x text-warning"></i>
          </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
     <div class="stat-card border-start border-success border-4">
  <div class="d-flex justify-content-between align-items-center">
     <div>
          <p class="text-muted mb-1">Completed</p>
               <h3 class="text-success mb-1">@ViewBag.CompletedThisMonth</h3>
        <small class="text-muted">Finished maintenance this month</small>
   </div>
  <i class="fas fa-check-circle fa-2x text-success"></i>
 </div>
        </div>
    </div>
</div>

<!-- Maintenance Records Table -->
<div class="dashboard-widget">
    <h5><i class="fas fa-list me-2"></i>Maintenance Records</h5>
    
    @if (Model != null && Model.Any())
    {
    <div class="table-responsive">
    <table class="table admin-table">
         <thead>
             <tr>
            <th>Vehicle Name</th>
<th>Maintenance Type</th>
<th>Date Scheduled</th>
               <th>Cost</th>
     <th>Status</th>
           <th>Actions</th>
     </tr>
    </thead>
         <tbody>
         @foreach (var item in Model)
        {
<tr>
         <td>
   <strong>@item.Car?.Brand @item.Car?.Model</strong><br />
       <small class="text-muted">@item.Car?.PlateNumber</small>
  </td>
              <td>@item.MaintenanceType</td>
        <td>@item.DateScheduled.ToString("MMM dd, yyyy")</td>
              <td><strong>@Html.Raw("&#8369;")@item.Cost.ToString("N2")</strong></td>
 <td>
@if (item.Status == "Urgent")
       {
<span class="badge bg-danger"><i class="fas fa-exclamation-circle me-1"></i>Urgent</span>
 }
            else if (item.Status == "Scheduled")
    {
     <span class="badge bg-warning"><i class="fas fa-clock me-1"></i>Scheduled</span>
       }
   else if (item.Status == "Completed")
    {
        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Completed</span>
       }
 </td>
          <td>
           <div class="btn-group" role="group">
         <a asp-action="Details" asp-route-id="@item.MaintenanceId" class="btn btn-sm btn-info" title="View Details">
          <i class="fas fa-eye"></i>
             </a>
      @if (item.Status != "Completed")
           {
      <button type="button" class="btn btn-sm btn-success" title="Complete Maintenance" 
   data-bs-toggle="modal" data-bs-target="#completeModal@(item.MaintenanceId)">
         <i class="fas fa-check-circle"></i>
                </button>
       }
             <a asp-action="Edit" asp-route-id="@item.MaintenanceId" class="btn btn-sm btn-warning" title="Edit">
             <i class="fas fa-edit"></i>
       </a>
          <a asp-action="Delete" asp-route-id="@item.MaintenanceId" class="btn btn-sm btn-danger" title="Delete">
      <i class="fas fa-trash"></i>
    </a>
        </div>
               </td>
            </tr>
          }
  </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="text-center py-5">
   <i class="fas fa-tools fa-4x text-muted mb-3"></i>
            <h4 class="text-muted">No Maintenance Records</h4>
        <p class="text-muted">Start by scheduling maintenance for your vehicles.</p>
      <a asp-action="Create" class="btn btn-admin-primary mt-3">
             <i class="fas fa-plus me-1"></i>Schedule First Maintenance
          </a>
     </div>
    }
</div>

<!-- Complete Maintenance Modals -->
@if (Model != null && Model.Any())
{
    @foreach (var item in Model)
    {
        @if (item.Status != "Completed")
     {
         <!-- Complete Modal -->
   <div class="modal fade" id="completeModal@(item.MaintenanceId)" tabindex="-1" aria-labelledby="completeModalLabel@(item.MaintenanceId)" aria-hidden="true">
          <div class="modal-dialog">
          <div class="modal-content">
            <form asp-action="CompleteMaintenance" method="post">
        <div class="modal-header bg-success text-white">
      <h5 class="modal-title" id="completeModalLabel@(item.MaintenanceId)">
                <i class="fas fa-check-circle me-2"></i>Complete Maintenance
         </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
               <div class="modal-body">
         <input type="hidden" name="id" value="@item.MaintenanceId" />
 @Html.AntiForgeryToken()
       
    <div class="mb-3">
  <h6>Vehicle: <strong>@item.Car?.Brand @item.Car?.Model</strong></h6>
               <p class="text-muted mb-0">@item.MaintenanceType</p>
       </div>
        
     <div class="mb-3">
      <label for="actualCost@(item.MaintenanceId)" class="form-label">Actual Cost (Optional)</label>
      <div class="input-group">
   <span class="input-group-text">@Html.Raw("&#8369;")</span>
  <input type="number" class="form-control" id="actualCost@(item.MaintenanceId)" 
        name="actualCost" step="0.01" min="0" 
           placeholder="@item.Cost.ToString("N2")" />
       </div>
      <small class="text-muted">Leave empty to keep the original cost of @Html.Raw("&#8369;")@item.Cost.ToString("N2")</small>
 </div>
   
          <div class="mb-3">
            <label for="completionNotes@(item.MaintenanceId)" class="form-label">Completion Notes (Optional)</label>
                <textarea class="form-control" id="completionNotes@(item.MaintenanceId)" 
         name="completionNotes" rows="3" 
  placeholder="Add any notes about the completed maintenance..."></textarea>
      </div>
     
    <div class="alert alert-info mb-0">
         <i class="fas fa-info-circle me-1"></i>
  <small>This will mark the maintenance as completed and set the vehicle back to "Available" status (if no other active maintenance exists).</small>
           </div>
  </div>
          <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
     <i class="fas fa-times me-1"></i>Cancel
      </button>
      <button type="submit" class="btn btn-success">
    <i class="fas fa-check-circle me-1"></i>Complete Maintenance
       </button>
          </div>
        </form>
     </div>
        </div>
    </div>
      }
    }
}

@section Scripts {
    <script>
        // Auto-hide success/error messages after 5 seconds
     setTimeout(function() {
    $('.alert').fadeOut('slow');
        }, 5000);
    </script>
}

@section Styles {
    <style>
    /* Mobile responsive styles for Maintenance Management page */
    
        /* Tablet and below */
        @@media (max-width: 768px) {
         .admin-table {
font-size: 0.85rem;
 }

         .admin-table td, .admin-table th {
        padding: 0.5rem 0.25rem;
              white-space: nowrap;
}

          .admin-table .btn-group {
   display: flex;
  flex-wrap: nowrap;
 }

          .admin-table .btn-group .btn {
      padding: 0.25rem 0.4rem;
  font-size: 0.75rem;
     }

    .admin-table .btn-group .btn i {
      font-size: 0.75rem;
         }

    /* Stack stat cards on smaller tablets */
            .stat-card {
    padding: 0.75rem;
}

            .stat-card h3 {
     font-size: 1.5rem;
      }
        }

        /* Mobile - 527px and below */
        @@media (max-width: 527px) {
      /* Make table more compact */
   .admin-table {
          font-size: 0.75rem;
            }

   .admin-table td, .admin-table th {
    padding: 0.4rem 0.2rem;
         font-size: 0.75rem;
      }

  /* Make action buttons very compact */
        .admin-table .btn-group {
   display: flex;
    flex-wrap: nowrap;
        gap: 2px;
        }

     .admin-table .btn-group .btn {
padding: 0.2rem 0.3rem;
     font-size: 0.65rem;
             min-width: auto;
  border-radius: 0.2rem;
       }

      .admin-table .btn-group .btn i {
   font-size: 0.7rem;
    margin: 0;
     }

            /* Reduce badge sizes */
     .admin-table .badge {
                font-size: 0.65rem;
    padding: 0.2rem 0.3rem;
    }

     /* Make page header responsive */
     .page-header .d-flex {
  flex-direction: column;
     align-items: flex-start !important;
         }

        .page-header .btn {
        margin-top: 0.5rem;
   width: 100%;
      font-size: 0.85rem;
  }

  .page-header h1 {
     font-size: 1.5rem;
  }

    /* Stat cards responsive */
    .stat-card {
      padding: 0.5rem;
      }

      .stat-card h3 {
     font-size: 1.25rem;
 }

       .stat-card small {
    font-size: 0.7rem;
            }

  .stat-card .fa-2x {
         font-size: 1.5rem !important;
        }

            /* Alert messages */
       .alert {
          font-size: 0.85rem;
        padding: 0.5rem;
    }
        }

        /* Extra small mobile - 400px and below */
        @@media (max-width: 400px) {
         .admin-table .btn-group {
  flex-direction: column;
  gap: 2px;
          width: 100%;
     }

   .admin-table .btn-group .btn {
    width: 100%;
    padding: 0.25rem 0.3rem;
          font-size: 0.65rem;
}

   .admin-table .btn-group .btn i {
           margin-right: 0.2rem;
         }

    /* Stack table cells vertically for better readability */
.admin-table thead {
             display: none;
  }

     .admin-table tbody tr {
 display: block;
    margin-bottom: 1rem;
     border: 1px solid #dee2e6;
      border-radius: 0.375rem;
           padding: 0.5rem;
          }

.admin-table tbody td {
     display: block;
              text-align: left;
 padding: 0.3rem 0.5rem;
    border: none;
  }

      .admin-table tbody td:before {
         content: attr(data-label);
      font-weight: bold;
     display: inline-block;
           width: 100px;
      }

            /* Stat cards full width */
      .row.mb-4 .col-md-4 {
          margin-bottom: 0.5rem !important;
   }

      .stat-card h3 {
      font-size: 1.1rem;
     }
        }
    </style>
}
