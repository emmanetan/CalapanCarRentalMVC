@model CalapanCarRentalMVC.Models.Car
@{
    ViewData["Title"] = "Edit Car";
}

<div class="container my-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Car</h3>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" method="post" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <input type="hidden" asp-for="VehicleId" />
                        <input type="hidden" asp-for="ImageUrl" />
                        <input type="hidden" asp-for="CreatedAt" />

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Brand" class="form-label"></label>
                                <input asp-for="Brand" class="form-control" />
                                <span asp-validation-for="Brand" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Model" class="form-label"></label>
                                <input asp-for="Model" class="form-control" />
                                <span asp-validation-for="Model" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label asp-for="Year" class="form-label"></label>
                                <input asp-for="Year" class="form-control" type="number" min="1900" max="2030" />
                                <span asp-validation-for="Year" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="Color" class="form-label"></label>
                                <input asp-for="Color" class="form-control" />
                                <span asp-validation-for="Color" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="PlateNumber" class="form-label"></label>
                                <input asp-for="PlateNumber" class="form-control" id="plateNumberInput" />
                                <span asp-validation-for="PlateNumber" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="Coding" class="form-label"></label>
                                <input asp-for="Coding" class="form-control bg-light" id="codingInput" style="cursor: not-allowed;" />
                                <span asp-validation-for="Coding" class="text-danger"></span>
                                <small class="form-text text-muted">Automatically set based on plate number ending digit</small>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label asp-for="TransmissionType" class="form-label"></label>
                                <select asp-for="TransmissionType" class="form-select">
                                    <option value="">Select...</option>
                                    <option value="Manual">Manual</option>
                                    <option value="Automatic">Automatic</option>
                                </select>
                                <span asp-validation-for="TransmissionType" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="SeatingCapacity" class="form-label"></label>
                                <input asp-for="SeatingCapacity" class="form-control" type="number" min="2" max="12" />
                                <span asp-validation-for="SeatingCapacity" class="text-danger"></span>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="GasType" class="form-label"></label>
                                <select asp-for="GasType" class="form-select">
                                    <option value="">Select...</option>
                                    <option value="Gasoline">Gasoline</option>
                                    <option value="Diesel">Diesel</option>
                                    <option value="Electric">Electric</option>
                                    <option value="Hybrid">Hybrid</option>
                                </select>
                                <span asp-validation-for="GasType" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="DailyRate" class="form-label"></label>
                                <input asp-for="DailyRate" class="form-control" type="number" step="0.01" min="0" />
                                <span asp-validation-for="DailyRate" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Status" class="form-label"></label>
                                <select asp-for="Status" class="form-select">
                                    <option value="Available">Available</option>
                                    <option value="Rented">Rented</option>
                                    <option value="Maintenance">Maintenance</option>
                                </select>
                                <span asp-validation-for="Status" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Change Car Image (Optional)</label>
                            <input type="file" name="imageFile" class="form-control" accept="image/*" />
                            <small class="text-muted">Leave empty to keep current image</small>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.ImageUrl))
                        {
                            <div class="mb-3">
                                <label class="form-label">Current Image</label>
                                <div>
                                    <img src="@Model.ImageUrl" alt="@Model.Brand @Model.Model" class="img-thumbnail" style="max-width: 300px; max-height: 200px;" />
                                </div>
                            </div>
                        }

                        <div class="mb-3">
                            <label asp-for="Description" class="form-label"></label>
                            <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Update Car
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <a asp-action="Details" asp-route-id="@Model.VehicleId" class="btn btn-info">
                                <i class="fas fa-info-circle me-2"></i>View Details
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    
    <script>
        $(document).ready(function() {
  // Function to calculate coding day based on plate number
   function updateCoding() {
      var plateNumber = $('#plateNumberInput').val().trim();
    
    if (plateNumber.length > 0) {
 // Get the last character of the plate number
   var lastChar = plateNumber.charAt(plateNumber.length - 1);
  var coding = '';
          
  // Determine coding day based on last digit
    switch(lastChar) {
  case '1':
   case '2':
    coding = 'Monday';
 break;
     case '3':
   case '4':
coding = 'Tuesday';
       break;
case '5':
     case '6':
     coding = 'Wednesday';
break;
   case '7':
      case '8':
       coding = 'Thursday';
        break;
case '9':
      case '0':
      coding = 'Friday';
    break;
default:
     coding = '';
    }
      
     $('#codingInput').val(coding);
   } else {
    $('#codingInput').val('');
         }
        }
    
  // Update coding when plate number changes
    $('#plateNumberInput').on('input', updateCoding);
          
        // Update coding on page load if plate number is already filled
       updateCoding();
       });
    </script>
}

